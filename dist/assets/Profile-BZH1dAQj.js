import{c as e,j as a,X as r,U as s,a as t,P as l,b as o,d as i,r as d,s as n,u as c,g as u}from"./index-CKLEMzqw.js";import{u as m,r as h}from"./router-DLm9MmqM.js";import{L as p,E as g,a as x}from"./lock-Cy8JwuvR.js";import{n as f,o as b,m as y,u as w,p as N,E as v,q as j,v as k}from"./firebase-C2GiP1il.js";import"./react-vendor-BQK9_sJn.js";
/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=e("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),C=e("pen-line",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),U=e("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),S=e("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),L=()=>{const e=m(),[L,F]=h.useState({displayName:"",firstName:"",lastName:"",email:"",phone:"",photoURL:""}),[E,M]=h.useState(!1),[$,R]=h.useState({}),[q,z]=h.useState(!0),[A,Y]=h.useState(!1),[B,D]=h.useState(!1),[H,_]=h.useState(""),[I,V]=h.useState(""),[O,T]=h.useState(null),[W,G]=h.useState(null),[J,K]=h.useState(navigator.onLine),[Q,X]=h.useState(!1),[Z,ee]=h.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[ae,re]=h.useState({current:!1,new:!1,confirm:!1});h.useEffect((()=>{const e=()=>K(!0),a=()=>K(!1);return window.addEventListener("online",e),window.addEventListener("offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}}),[]),h.useEffect((()=>{(async()=>{const a=o.onAuthStateChanged((async a=>{if(a)try{const e={displayName:a.displayName||"",firstName:"",lastName:"",email:a.email||"",phone:"",photoURL:a.photoURL||"https://via.placeholder.com/150?text=No+Photo"};if(F(e),!J)return _("You are offline. Some data may not be available."),void z(!1);const r=f(i,"users",a.uid),s=await b(r);if(s.exists()){const e=s.data(),r={displayName:a.displayName||`${e.firstName||""} ${e.lastName||""}`.trim()||"Not set",firstName:e.firstName||"",lastName:e.lastName||"",email:a.email||"",phone:e.phone||"",photoURL:a.photoURL||"https://via.placeholder.com/150?text=No+Photo"};F(r)}}catch(r){_(`Failed to fetch user data: ${r.message}`)}finally{z(!1)}else e("/profile")}))})()}),[e,J]);const se=(e,a)=>{R((r=>({...r,[e]:a})))};return q?a.jsx("div",{className:"flex justify-center items-center min-h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 py-8",children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsxs("div",{className:"max-w-md mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Your Profile"}),a.jsx("button",{onClick:()=>{E?(R({}),M(!1),_(""),V("")):(R({...L}),M(!0),_(""),V(""))},className:"flex items-center px-3 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg transition-colors",children:E?a.jsxs(a.Fragment,{children:[a.jsx(r,{className:"w-4 h-4 mr-1"}),"Cancel"]}):a.jsxs(a.Fragment,{children:[a.jsx(C,{className:"w-4 h-4 mr-1"}),"Edit"]})})]}),H&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:H})}),I&&a.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-lg",children:a.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:I})}),a.jsx("div",{className:"flex justify-center mb-6",children:a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:W||L.photoURL,alt:"Profile",className:"w-24 h-24 rounded-full object-cover border-4 border-blue-600 dark:border-blue-400",onError:e=>{e.target.src="https://via.placeholder.com/150?text=No+Photo"}}),A&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full",children:a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"})}),a.jsx("div",{className:"absolute bottom-0 right-0 bg-blue-600 rounded-full p-1",children:a.jsx(P,{className:"w-4 h-4 text-white"})})]})}),a.jsx("div",{className:"space-y-4 mb-6",children:E?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"First Name *"}),a.jsx("input",{type:"text",value:$.firstName||"",onChange:e=>se("firstName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"First name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Last Name *"}),a.jsx("input",{type:"text",value:$.lastName||"",onChange:e=>se("lastName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Last name"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email *"}),a.jsx("input",{type:"email",value:$.email||"",onChange:e=>se("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Email address"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone"}),a.jsx("input",{type:"tel",value:$.phone||"",onChange:e=>se("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Phone number"})]}),a.jsx("button",{onClick:async()=>{var e;if(!o.currentUser)return void _("You must be logged in to update your profile.");if(!J)return void _("Cannot update profile while offline.");const a=(()=>{var e,a,r;const s=[];return(null==(e=$.firstName)?void 0:e.trim())||s.push("First name is required"),(null==(a=$.lastName)?void 0:a.trim())||s.push("Last name is required"),(null==(r=$.email)?void 0:r.trim())?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($.email)||s.push("Please enter a valid email address"):s.push("Email is required"),$.phone&&!/^[\d\s\-\+\(\)]+$/.test($.phone)&&s.push("Please enter a valid phone number"),s})();if(a.length>0)_(a.join(", "));else{D(!0),_(""),V("");try{const a=o.currentUser.uid,r=f(i,"users",a),s={firstName:$.firstName.trim(),lastName:$.lastName.trim(),phone:(null==(e=$.phone)?void 0:e.trim())||"",updatedAt:(new Date).toISOString()};await y(r,s,{merge:!0});const t=`${$.firstName.trim()} ${$.lastName.trim()}`;await w(o.currentUser,{displayName:t}),$.email!==L.email&&await N(o.currentUser,$.email);const l={...$,displayName:t};F(l),M(!1),R({}),V("Profile updated successfully!")}catch(r){let e="Failed to update profile.";switch(r.code){case"auth/requires-recent-login":e="Please re-authenticate to update your email.";break;case"auth/email-already-in-use":e="This email is already in use by another account.";break;case"auth/invalid-email":e="Please enter a valid email address.";break;default:e=r.message||e}_(e)}finally{D(!1)}}},disabled:B||!J,className:"w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-2 px-4 rounded-xl font-semibold hover:from-green-700 hover:to-green-800 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:B?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx(U,{className:"w-4 h-4 inline mr-2"}),"Save Changes"]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(s,{className:"w-5 h-5 text-gray-400"}),a.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:[a.jsx("span",{className:"font-medium",children:"Name:"})," ",L.displayName||"Not set"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(t,{className:"w-5 h-5 text-gray-400"}),a.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:[a.jsx("span",{className:"font-medium",children:"Email:"})," ",L.email||"Not set"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(l,{className:"w-5 h-5 text-gray-400"}),a.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:[a.jsx("span",{className:"font-medium",children:"Phone:"})," ",L.phone||"Not set"]})]})]})}),!E&&a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-6 mb-6",children:[a.jsxs("button",{onClick:()=>X(!Q),className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"Change Password"]}),Q&&a.jsxs("div",{className:"mt-4 space-y-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:ae.current?"text":"password",placeholder:"Current Password",value:Z.currentPassword,onChange:e=>ee((a=>({...a,currentPassword:e.target.value}))),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:()=>re((e=>({...e,current:!e.current}))),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:ae.current?a.jsx(g,{className:"w-4 h-4"}):a.jsx(x,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:ae.new?"text":"password",placeholder:"New Password",value:Z.newPassword,onChange:e=>ee((a=>({...a,newPassword:e.target.value}))),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:()=>re((e=>({...e,new:!e.new}))),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:ae.new?a.jsx(g,{className:"w-4 h-4"}):a.jsx(x,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:ae.confirm?"text":"password",placeholder:"Confirm New Password",value:Z.confirmPassword,onChange:e=>ee((a=>({...a,confirmPassword:e.target.value}))),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:()=>re((e=>({...e,confirm:!e.confirm}))),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:ae.confirm?a.jsx(g,{className:"w-4 h-4"}):a.jsx(x,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:async()=>{if(!o.currentUser)return void _("You must be logged in to change your password.");if(!J)return void _("Cannot change password while offline.");const{currentPassword:e,newPassword:a,confirmPassword:r}=Z;if(e&&a&&r)if(a===r)if(a.length<6)_("New password must be at least 6 characters long.");else{D(!0),_("");try{const r=v.credential(o.currentUser.email,e);await j(o.currentUser,r),await k(o.currentUser,a),V("Password updated successfully!"),X(!1),ee({currentPassword:"",newPassword:"",confirmPassword:""})}catch(s){let e="Failed to change password.";switch(s.code){case"auth/wrong-password":e="Current password is incorrect.";break;case"auth/weak-password":e="New password is too weak.";break;default:e=s.message||e}_(e)}finally{D(!1)}}else _("New passwords do not match.");else _("All password fields are required.")},disabled:B||!J,className:"flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white py-2 px-4 rounded-lg font-medium hover:from-purple-700 hover:to-purple-800 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:B?"Updating...":"Update Password"}),a.jsx("button",{onClick:()=>{X(!1),ee({currentPassword:"",newPassword:"",confirmPassword:""})},className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Cancel"})]})]})]}),!E&&a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-6",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[a.jsx(S,{className:"w-4 h-4 inline mr-2"}),"Update Profile Photo"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(a){if(!a.type.startsWith("image/"))return void _("Please select a valid image file.");if(a.size>5242880)return void _("File size must be less than 5MB.");T(a);const e=new FileReader;e.onload=e=>G(e.target.result),e.readAsDataURL(a),_(""),V("")}},className:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-gray-700 dark:file:text-gray-300"}),O&&a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",O.name," (",(O.size/1024/1024).toFixed(2)," MB)"]}),a.jsx("button",{onClick:async()=>{if(O)if(J)if(o.currentUser){Y(!0),_(""),V("");try{const e=`profile_photo_${Date.now()}_${O.name}`,a=d(n,`profile_photos/${o.currentUser.uid}/${e}`),r={contentType:O.type,customMetadata:{uploadedBy:o.currentUser.uid,uploadedAt:(new Date).toISOString()}};await c(a,O,r);const s=await u(a);await w(o.currentUser,{photoURL:s}),F((e=>({...e,photoURL:s}))),V("Profile photo updated successfully!"),T(null),G(null);const t=document.getElementById("photo-upload");t&&(t.value="")}catch(e){let a="Failed to upload photo.";_(e.message||a)}finally{Y(!1)}}else _("You must be logged in to upload a photo.");else _("Cannot upload photo while offline.");else _("Please select a photo to upload.")},disabled:A||!O||!J,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 px-4 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:A?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Uploading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(S,{className:"w-4 h-4 inline mr-2"}),"Upload Photo"]})})]})]})]})})})};export{L as default};
