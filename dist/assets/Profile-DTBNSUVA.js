import{r as e,j as a,X as r,s,t,u as l,U as o,e as i,P as n,o as d,E as c,p as u,v as m}from"./trip-components-CFAaFKI4.js";import{a as h,d as p,r as g,s as x,u as f,g as b}from"./index-Bo-Ow9Nt.js";import{n as y,o as w,m as N,u as v,p as j,E as k,q as P,v as C}from"./firebase-C2GiP1il.js";import{u as U}from"./router-CDJVE5pb.js";import"./react-vendor-BQK9_sJn.js";const S=()=>{const S=U(),[L,F]=e.useState({displayName:"",firstName:"",lastName:"",email:"",phone:"",photoURL:""}),[E,$]=e.useState(!1),[R,q]=e.useState({}),[A,Y]=e.useState(!0),[B,D]=e.useState(!1),[_,z]=e.useState(!1),[I,M]=e.useState(""),[O,T]=e.useState(""),[W,G]=e.useState(null),[H,J]=e.useState(null),[K,Q]=e.useState(navigator.onLine),[V,X]=e.useState(!1),[Z,ee]=e.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[ae,re]=e.useState({current:!1,new:!1,confirm:!1});e.useEffect((()=>{const e=()=>Q(!0),a=()=>Q(!1);return window.addEventListener("online",e),window.addEventListener("offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}}),[]),e.useEffect((()=>{(async()=>{const e=h.onAuthStateChanged((async e=>{if(e)try{const a={displayName:e.displayName||"",firstName:"",lastName:"",email:e.email||"",phone:"",photoURL:e.photoURL||"https://via.placeholder.com/150?text=No+Photo"};if(F(a),!K)return M("You are offline. Some data may not be available."),void Y(!1);const r=y(p,"users",e.uid),s=await w(r);if(s.exists()){const a=s.data(),r={displayName:e.displayName||`${a.firstName||""} ${a.lastName||""}`.trim()||"Not set",firstName:a.firstName||"",lastName:a.lastName||"",email:e.email||"",phone:a.phone||"",photoURL:e.photoURL||"https://via.placeholder.com/150?text=No+Photo"};F(r)}}catch(a){M(`Failed to fetch user data: ${a.message}`)}finally{Y(!1)}else S("/profile")}))})()}),[S,K]);const se=(e,a)=>{q((r=>({...r,[e]:a})))};return A?a.jsx("div",{className:"flex justify-center items-center min-h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 py-8",children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsxs("div",{className:"max-w-md mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Your Profile"}),a.jsx("button",{onClick:()=>{E?(q({}),$(!1),M(""),T("")):(q({...L}),$(!0),M(""),T(""))},className:"flex items-center px-3 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg transition-colors",children:E?a.jsxs(a.Fragment,{children:[a.jsx(r,{className:"w-4 h-4 mr-1"}),"Cancel"]}):a.jsxs(a.Fragment,{children:[a.jsx(s,{className:"w-4 h-4 mr-1"}),"Edit"]})})]}),I&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:I})}),O&&a.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-lg",children:a.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:O})}),a.jsx("div",{className:"flex justify-center mb-6",children:a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:H||L.photoURL,alt:"Profile",className:"w-24 h-24 rounded-full object-cover border-4 border-blue-600 dark:border-blue-400",onError:e=>{e.target.src="https://via.placeholder.com/150?text=No+Photo"}}),B&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full",children:a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"})}),a.jsx("div",{className:"absolute bottom-0 right-0 bg-blue-600 rounded-full p-1",children:a.jsx(t,{className:"w-4 h-4 text-white"})})]})}),a.jsx("div",{className:"space-y-4 mb-6",children:E?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"First Name *"}),a.jsx("input",{type:"text",value:R.firstName||"",onChange:e=>se("firstName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"First name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Last Name *"}),a.jsx("input",{type:"text",value:R.lastName||"",onChange:e=>se("lastName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Last name"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email *"}),a.jsx("input",{type:"email",value:R.email||"",onChange:e=>se("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Email address"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone"}),a.jsx("input",{type:"tel",value:R.phone||"",onChange:e=>se("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Phone number"})]}),a.jsx("button",{onClick:async()=>{var e;if(!h.currentUser)return void M("You must be logged in to update your profile.");if(!K)return void M("Cannot update profile while offline.");const a=(()=>{var e,a,r;const s=[];return(null==(e=R.firstName)?void 0:e.trim())||s.push("First name is required"),(null==(a=R.lastName)?void 0:a.trim())||s.push("Last name is required"),(null==(r=R.email)?void 0:r.trim())?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(R.email)||s.push("Please enter a valid email address"):s.push("Email is required"),R.phone&&!/^[\d\s\-\+\(\)]+$/.test(R.phone)&&s.push("Please enter a valid phone number"),s})();if(a.length>0)M(a.join(", "));else{z(!0),M(""),T("");try{const a=h.currentUser.uid,r=y(p,"users",a),s={firstName:R.firstName.trim(),lastName:R.lastName.trim(),phone:(null==(e=R.phone)?void 0:e.trim())||"",updatedAt:(new Date).toISOString()};await N(r,s,{merge:!0});const t=`${R.firstName.trim()} ${R.lastName.trim()}`;await v(h.currentUser,{displayName:t}),R.email!==L.email&&await j(h.currentUser,R.email);const l={...R,displayName:t};F(l),$(!1),q({}),T("Profile updated successfully!")}catch(r){let e="Failed to update profile.";switch(r.code){case"auth/requires-recent-login":e="Please re-authenticate to update your email.";break;case"auth/email-already-in-use":e="This email is already in use by another account.";break;case"auth/invalid-email":e="Please enter a valid email address.";break;default:e=r.message||e}M(e)}finally{z(!1)}}},disabled:_||!K,className:"w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-2 px-4 rounded-xl font-semibold hover:from-green-700 hover:to-green-800 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:_?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx(l,{className:"w-4 h-4 inline mr-2"}),"Save Changes"]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(o,{className:"w-5 h-5 text-gray-400"}),a.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:[a.jsx("span",{className:"font-medium",children:"Name:"})," ",L.displayName||"Not set"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(i,{className:"w-5 h-5 text-gray-400"}),a.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:[a.jsx("span",{className:"font-medium",children:"Email:"})," ",L.email||"Not set"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(n,{className:"w-5 h-5 text-gray-400"}),a.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:[a.jsx("span",{className:"font-medium",children:"Phone:"})," ",L.phone||"Not set"]})]})]})}),!E&&a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-6 mb-6",children:[a.jsxs("button",{onClick:()=>X(!V),className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"Change Password"]}),V&&a.jsxs("div",{className:"mt-4 space-y-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:ae.current?"text":"password",placeholder:"Current Password",value:Z.currentPassword,onChange:e=>ee((a=>({...a,currentPassword:e.target.value}))),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:()=>re((e=>({...e,current:!e.current}))),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:ae.current?a.jsx(c,{className:"w-4 h-4"}):a.jsx(u,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:ae.new?"text":"password",placeholder:"New Password",value:Z.newPassword,onChange:e=>ee((a=>({...a,newPassword:e.target.value}))),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:()=>re((e=>({...e,new:!e.new}))),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:ae.new?a.jsx(c,{className:"w-4 h-4"}):a.jsx(u,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:ae.confirm?"text":"password",placeholder:"Confirm New Password",value:Z.confirmPassword,onChange:e=>ee((a=>({...a,confirmPassword:e.target.value}))),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:()=>re((e=>({...e,confirm:!e.confirm}))),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:ae.confirm?a.jsx(c,{className:"w-4 h-4"}):a.jsx(u,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:async()=>{if(!h.currentUser)return void M("You must be logged in to change your password.");if(!K)return void M("Cannot change password while offline.");const{currentPassword:e,newPassword:a,confirmPassword:r}=Z;if(e&&a&&r)if(a===r)if(a.length<6)M("New password must be at least 6 characters long.");else{z(!0),M("");try{const r=k.credential(h.currentUser.email,e);await P(h.currentUser,r),await C(h.currentUser,a),T("Password updated successfully!"),X(!1),ee({currentPassword:"",newPassword:"",confirmPassword:""})}catch(s){let e="Failed to change password.";switch(s.code){case"auth/wrong-password":e="Current password is incorrect.";break;case"auth/weak-password":e="New password is too weak.";break;default:e=s.message||e}M(e)}finally{z(!1)}}else M("New passwords do not match.");else M("All password fields are required.")},disabled:_||!K,className:"flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white py-2 px-4 rounded-lg font-medium hover:from-purple-700 hover:to-purple-800 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Updating...":"Update Password"}),a.jsx("button",{onClick:()=>{X(!1),ee({currentPassword:"",newPassword:"",confirmPassword:""})},className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Cancel"})]})]})]}),!E&&a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-6",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[a.jsx(m,{className:"w-4 h-4 inline mr-2"}),"Update Profile Photo"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(a){if(!a.type.startsWith("image/"))return void M("Please select a valid image file.");if(a.size>5242880)return void M("File size must be less than 5MB.");G(a);const e=new FileReader;e.onload=e=>J(e.target.result),e.readAsDataURL(a),M(""),T("")}},className:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-gray-700 dark:file:text-gray-300"}),W&&a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",W.name," (",(W.size/1024/1024).toFixed(2)," MB)"]}),a.jsx("button",{onClick:async()=>{if(W)if(K)if(h.currentUser){D(!0),M(""),T("");try{const e=`profile_photo_${Date.now()}_${W.name}`,a=g(x,`profile_photos/${h.currentUser.uid}/${e}`),r={contentType:W.type,customMetadata:{uploadedBy:h.currentUser.uid,uploadedAt:(new Date).toISOString()}};await f(a,W,r);const s=await b(a);await v(h.currentUser,{photoURL:s}),F((e=>({...e,photoURL:s}))),T("Profile photo updated successfully!"),G(null),J(null);const t=document.getElementById("photo-upload");t&&(t.value="")}catch(e){let a="Failed to upload photo.";M(e.message||a)}finally{D(!1)}}else M("You must be logged in to upload a photo.");else M("Cannot upload photo while offline.");else M("Please select a photo to upload.")},disabled:B||!W||!K,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 px-4 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:B?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Uploading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(m,{className:"w-4 h-4 inline mr-2"}),"Upload Photo"]})})]})]})]})})})};export{S as default};
